package Bubl_Batch_Distil
  partial connector Tray_port
    Real Comp;
    flow Real M;
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})));
  end Tray_port;

  connector Tray_port_Vap_Out
    extends Tray_port;
    annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {75.43, -75.08}, lineThickness = 0.5, extent = {{-154.75, 141.93}, {1.59, -1.41}})}), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0.18, -0.35}, fillColor = {255, 255, 255}, fillPattern = FillPattern.Solid, lineThickness = 1, extent = {{-96.64, 96.82}, {96.64, -96.82}})}));
  end Tray_port_Vap_Out;

  connector Tray_port_Vap_In
    extends Tray_port;
    annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {76.8104, -81.9643}, fillPattern = FillPattern.Solid, extent = {{-158.779, 155.966}, {5.15, -5.15}})}), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0.23, -0.23}, fillPattern = FillPattern.Solid, extent = {{-99.06, 99.06}, {99.06, -99.06}})}));
  end Tray_port_Vap_In;

  connector Tray_port_Liq_Out
    extends Tray_port;
    annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {75.43, -75.08}, lineThickness = 0.5, extent = {{-154.75, 141.93}, {1.59, -1.41}})}), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0.18, -0.35}, fillColor = {255, 255, 255}, fillPattern = FillPattern.Solid, lineThickness = 1, extent = {{-96.64, 96.82}, {96.64, -96.82}})}));
  end Tray_port_Liq_Out;

  connector Tray_port_Liq_In
    extends Tray_port;
    annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {76.8104, -81.9643}, fillPattern = FillPattern.Solid, extent = {{-158.779, 155.966}, {5.15, -5.15}})}), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0.23, -0.23}, fillPattern = FillPattern.Solid, extent = {{-99.06, 99.06}, {99.06, -99.06}})}));
  end Tray_port_Liq_In;

  function PVF
    input String Prop;
    input Real P, VF;
    input String Comp1, Comp2;
    input Real x1;
    output Real Result[2];
  
    external "C" PVFFlash(Prop, P, VF, Comp1, Comp2, x1, Result);
    annotation(Include = "#include\"C:/Clients/PVFFlash.c\"");
  end PVF;

  model Tray
    parameter Real M = 20, P = 100000;
    parameter String Comp1 = "Methanol", Comp2 = "Water";
    Real Vin(start = 10), Lin, X1(start = 0), Y1, Vledata[2], L, V, Xin, Yin, T;
    Bubl_Batch_Distil.Tray_port_Liq_In tray_port_liq_in1 annotation(Placement(visible = true, transformation(origin = {80, 16}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {72, 16}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Bubl_Batch_Distil.Tray_port_Liq_Out tray_port_liq_out1 annotation(Placement(visible = true, transformation(origin = {80, -16}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {70, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Bubl_Batch_Distil.Tray_port_Vap_In tray_port_vap_in1 annotation(Placement(visible = true, transformation(origin = {-72, -16}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-74, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Bubl_Batch_Distil.Tray_port_Vap_Out tray_port_vap_out1 annotation(Placement(visible = true, transformation(origin = {-72, 16}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-74, 16}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  equation
    Vin = tray_port_vap_in1.M;
    Lin = tray_port_liq_in1.M;
    Xin = tray_port_liq_in1.Comp;
    Yin = tray_port_vap_in1.Comp;
    der(X1) = (Lin * Xin - L * X1 + Vin * Yin - V * Y1) / M;
    Vledata = PVF("NRTL", P, 0.0000001, Comp1, Comp2, X1);
    Y1 = Vledata[1];
    T = Vledata[2];
    L = Lin;
    V = Vin;
    tray_port_liq_out1.M = -L;
    tray_port_liq_out1.Comp = X1;
    tray_port_vap_out1.M = -V;
    tray_port_vap_out1.Comp = Y1;
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Bitmap(origin = {-15, -23}, extent = {{107, 11}, {-77, 33}}, imageSource = "iVBORw0KGgoAAAANSUhEUgAAAdoAAAA8CAIAAABO7OzTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIJSURBVHhe7dRbjuJQDEXRmv8wenQ9C9rCjoTzKEJBu/KxlrYEXPL4O183AC7AHANcgjkGuARzDHAJNcdfXR4C8HG1s4s6NccAw2pnF3VqjgGG1c4u6tQcAwyrnV3UqTkGGFY7u6hTcwwwrHZ2UafmGGBY7eyiTs0xwLDa2UWdmmOAYbWzizo9mmMAxtQO1wcAv8ccA1yCOQa4BHMM8Ptqh+tj5c9fSdJ/qcsRDuZYkmbrcoSDOZak2boc4WCOJWm2Lkc4mGNJmq3LEQ7mWJJm63KEgzmWpNm6HOFgjiVpti5HOJhjSZqtyxEO5liSZutyhIM5lqTZuhzhYI4labYuRziYY0marcsRDuZYkmbrcoSDOZak2boc4WCOJWm2Lkc4mGNJmq3LEQ7mWJJm63KEgzmWpNm6HOFgjiVpti5HOBzMcVjdL0l6v40c4fDwbWX1CEnS+3W1v3fmWJIG62p/747nOKyeIkl6p43a37v+Y2v1LEnSz9qo5V08m+OweqIk6dX21PIuNr93rZ4rSTrfntrcB3tHu1ZPlySdaU+tbXd6jtPqNZKkow7U1G4cjPT3Vq+UJD32rdrZjcM/Qt0KwCfUth549jcAn1CreuzEFQC8ocb0mdPXAfC62tATXrg01RsAOFBz+aIf3gbAZ5ljgEswxwCXYI4BLsEcA1yCOQa4BHMMcAG32z9lLOcbDquHgAAAAABJRU5ErkJggg==")}), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Bitmap(origin = {2, -10}, extent = {{92, 20}, {-90, 0}}, imageSource = "iVBORw0KGgoAAAANSUhEUgAAAdoAAAA8CAIAAABO7OzTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIJSURBVHhe7dRbjuJQDEXRmv8wenQ9C9rCjoTzKEJBu/KxlrYEXPL4O183AC7AHANcgjkGuARzDHAJNcdfXR4C8HG1s4s6NccAw2pnF3VqjgGG1c4u6tQcAwyrnV3UqTkGGFY7u6hTcwwwrHZ2UafmGGBY7eyiTs0xwLDa2UWdmmOAYbWzizo9mmMAxtQO1wcAv8ccA1yCOQa4BHMM8Ptqh+tj5c9fSdJ/qcsRDuZYkmbrcoSDOZak2boc4WCOJWm2Lkc4mGNJmq3LEQ7mWJJm63KEgzmWpNm6HOFgjiVpti5HOJhjSZqtyxEO5liSZutyhIM5lqTZuhzhYI4labYuRziYY0marcsRDuZYkmbrcoSDOZak2boc4WCOJWm2Lkc4mGNJmq3LEQ7mWJJm63KEgzmWpNm6HOFgjiVpti5HOBzMcVjdL0l6v40c4fDwbWX1CEnS+3W1v3fmWJIG62p/747nOKyeIkl6p43a37v+Y2v1LEnSz9qo5V08m+OweqIk6dX21PIuNr93rZ4rSTrfntrcB3tHu1ZPlySdaU+tbXd6jtPqNZKkow7U1G4cjPT3Vq+UJD32rdrZjcM/Qt0KwCfUth549jcAn1CreuzEFQC8ocb0mdPXAfC62tATXrg01RsAOFBz+aIf3gbAZ5ljgEswxwCXYI4BLsEcA1yCOQa4BHMMcAG32z9lLOcbDquHgAAAAABJRU5ErkJggg==")}));
  end Tray;

  model Condenser
    parameter Real M = 100;
    Real R(start = 100000000), X1(start = 0), D, V, L, Yin;
    Bubl_Batch_Distil.Tray_port_Vap_In tray_port_vap_in1 annotation(Placement(visible = true, transformation(origin = {-74, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-74, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Bubl_Batch_Distil.Tray_port_Liq_Out tray_port_liq_out1 annotation(Placement(visible = true, transformation(origin = {-72, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-72, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  equation
    V = tray_port_vap_in1.M;
    Yin = tray_port_vap_in1.Comp;
    D = V / (R + 1);
    L = V - D;
    R = if time <= 20 then 100000000 else 10;
    der(X1) = (V * Yin - (L + D) * X1) / M;
    tray_port_liq_out1.M = -L;
    tray_port_liq_out1.Comp = X1;
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Bitmap(origin = {-61, -19}, extent = {{-37, 31}, {161, -11}}, imageSource = "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")}), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Bitmap(origin = {-2, -48}, extent = {{98, 16}, {-94, 60}}, imageSource = "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")}));
  end Condenser;

  model Reboiler
    parameter Real V = 10;
    parameter Real P = 100000;
    parameter String Comp1 = "Methanol", Comp2 = "Water";
    Real Mb(start = 2500), XB(start = 0.8), Xin, YB, L(start = 0), Vledata[2], T;
    Bubl_Batch_Distil.Tray_port_Liq_In tray_port_liq_in1 annotation(Placement(visible = true, transformation(origin = {72, 24}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {72, 24}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Bubl_Batch_Distil.Tray_port_Vap_Out tray_port_vap_out1 annotation(Placement(visible = true, transformation(origin = {-72, 24}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-72, 24}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  algorithm
    L := tray_port_liq_in1.M;
    Xin := tray_port_liq_in1.Comp;
  equation
    der(Mb) = L - V;
    Mb * der(XB) = L * Xin - V * YB;
    Vledata = PVF("NRTL", P, 0.0000001, Comp1, Comp2, XB);
    YB = Vledata[1];
    T = Vledata[2];
  algorithm
    tray_port_vap_out1.M := -V;
    tray_port_vap_out1.Comp := YB;
    annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Bitmap(origin = {74, -22}, extent = {{20, -6}, {-172, 38}}, imageSource = "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")}), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Bitmap(origin = {-69, -25}, extent = {{163, 39}, {-27, 7}}, imageSource = "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")}));
  end Reboiler;

  model distil
    Bubl_Batch_Distil.Tray tray1(X1(fixed = true)) annotation(Placement(visible = true, transformation(origin = {-48, 28}, extent = {{-30, -30}, {30, 30}}, rotation = 0)));
    Bubl_Batch_Distil.Tray tray2(X1(fixed = true)) annotation(Placement(visible = true, transformation(origin = {-48, 3.55271e-15}, extent = {{-30, -30}, {30, 30}}, rotation = 0)));
    Bubl_Batch_Distil.Tray tray3(X1(fixed = true)) annotation(Placement(visible = true, transformation(origin = {-47, -27}, extent = {{-31, -31}, {31, 31}}, rotation = 0)));
    Bubl_Batch_Distil.Tray tray4(X1(fixed = true), L(fixed = false), V(fixed = false)) annotation(Placement(visible = true, transformation(origin = {-47, -55}, extent = {{-31, -31}, {31, 31}}, rotation = 0)));
    Bubl_Batch_Distil.Reboiler reboiler1(Mb(fixed = true), XB(fixed = true), L(fixed = false)) annotation(Placement(visible = true, transformation(origin = {48, -84}, extent = {{-52, -52}, {52, 52}}, rotation = 0)));
    Bubl_Batch_Distil.Condenser condenser1(X1(fixed = true)) annotation(Placement(visible = true, transformation(origin = {44, 72}, extent = {{-52, -52}, {52, 52}}, rotation = 0)));
  equation
    connect(tray1.tray_port_vap_out1, condenser1.tray_port_vap_in1) annotation(Line(points = {{-70, 33}, {-70, 82}, {6, 82}}));
    connect(condenser1.tray_port_liq_out1, tray1.tray_port_liq_in1) annotation(Line(points = {{7, 51}, {24.5, 51}, {24.5, 33}, {-26, 33}}));
    connect(reboiler1.tray_port_vap_out1, tray4.tray_port_vap_in1) annotation(Line(points = {{11, -72}, {-70, -72}, {-70, -61}}));
    connect(tray4.tray_port_liq_out1, reboiler1.tray_port_liq_in1) annotation(Line(points = {{-25, -61}, {85, -61}, {85, -72}}));
    connect(tray3.tray_port_liq_out1, tray4.tray_port_liq_in1) annotation(Line(points = {{-25, -33}, {-25, -50}}));
    connect(tray4.tray_port_vap_out1, tray3.tray_port_vap_in1) annotation(Line(points = {{-70, -50}, {-70, -33}}));
    connect(tray2.tray_port_liq_out1, tray3.tray_port_liq_in1) annotation(Line(points = {{-27, -6}, {-25, -6}, {-25, -22}}));
    connect(tray2.tray_port_vap_in1, tray3.tray_port_vap_out1) annotation(Line(points = {{-70, -6}, {-70, -22}}));
    connect(tray1.tray_port_vap_in1, tray2.tray_port_vap_out1) annotation(Line(points = {{-70, 22}, {-70, 5}}));
    connect(tray1.tray_port_liq_out1, tray2.tray_port_liq_in1) annotation(Line(points = {{-27, 22}, {-26, 22}, {-26, 5}}));
  end distil;
end Bubl_Batch_Distil;
